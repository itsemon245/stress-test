user                 www-data;
worker_processes     auto;
worker_rlimit_nofile 100000;
pid                  /run/nginx.pid;

events {
    worker_connections                  4096;
    multi_accept                        on;
}

http {
    include                             /etc/nginx/mime.types;
    default_type                        application/octet-stream;

    server_tokens                       off;
    sendfile                            on;
    tcp_nopush                          on;
    tcp_nodelay                         on;
    send_timeout                        2;
    reset_timedout_connection           on;
    keepalive_timeout                   5;
    keepalive_requests                  500;
    types_hash_max_size                 2048;
    fastcgi_read_timeout                360;
    fastcgi_buffer_size                 64k;
    fastcgi_buffers                     4 64k;
    client_body_buffer_size             10M;
    client_max_body_size                100M;
    client_body_timeout                 10;
    client_body_in_file_only            clean;
    open_file_cache                     max=200000 inactive=20s;
    open_file_cache_valid               30s;
    open_file_cache_min_uses            2;
    open_file_cache_errors              on;
    proxy_connect_timeout               60;
    proxy_read_timeout                  60;
    proxy_send_timeout                  60;
    server_name_in_redirect             off;

    # settings from nginx bad bot blocker moved here
    server_names_hash_bucket_size 256;
    server_names_hash_max_size 4096;
    variables_hash_max_size 4096;
    variables_hash_bucket_size 4096;
    ###

    ssl_session_cache                   shared:SSL:20m;
    ssl_session_timeout                 10m;
    ssl_prefer_server_ciphers           on;
    ssl_ciphers                         'ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:CAMELLIA:DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA';
    ssl_protocols                       TLSv1.1 TLSv1.2;

    log_format                          main '[$time_local] $remote_user $remote_addr $http_x_forwarded_for "$host" "$request" '
                                        '$status $body_bytes_sent "$http_referer" '
                                        '"$http_user_agent" $request_time "$request_body"' ;
    access_log                          /var/log/nginx/access.log main;
    error_log                           /var/log/nginx/error.log  info;

    gzip                                on;
    gzip_disable                        "MSIE [1-6]\.(?!.*SV1)";
    gzip_vary                           on;
    gzip_proxied                        any;
    gzip_comp_level                     7;
    gzip_buffers                        16 8k;
    gzip_http_version                   1.1;
    gzip_types
        application/atom+xml
        application/javascript
        application/json
        application/rss+xml
        application/vnd.ms-fontobject
        application/x-font-ttf
        application/x-web-app-manifest+json
        application/xhtml+xml
        application/xml
        font/opentype
        image/svg+xml
        image/x-icon
        text/css
        text/plain
        text/x-component
        text/xml
        text/javascript;

    ##
    # Virtual Host Configs
    ##

    include                             /etc/nginx/conf.d/*.conf;
    include                             /etc/nginx/sites-enabled/*.conf;
}
